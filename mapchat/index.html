<!DOCTYPE html>

<html>
<head>
	<title> Mapchat </title>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=true"></script>
	<link rel="stylesheet" href="style.css"/>
	
	<script>

		function init() {
			console.log("inside init function");

			console.log("calling get my location");
			get_my_location();



			/* Declares my variables and options*/
			// console.log("inside get_my_location");
			// var my_lat = 0;
			// var my_lng = 0;
			// var me = new google.maps.LatLng(my_lat, my_lng);
			// var map_options = {
			// 	zoom: 8,
			// 	center: me,
			// 	mapTypeId: google.maps.MapTypeId.ROADMAP
			// };

			// var map = new google.maps.Map(document.getElementById("map"), map_options);
			// // 	console.log("calling get my location");
			// };
			// var map;

			//  Draws map according to specifications 
			// // function initMap() {
			// 	map = new google.maps.Map(document.getElementById("map"), map_options);
			// 	console.log("calling get my location");
			// 	get_my_location();
			
		}

		/* Getting my location */
		function get_my_location() {

			if (navigator.geolocation) {
				console.log("not getting in here?");
				navigator.geolocation.getCurrentPosition(function(position) {
					console.log("getting my location");
					my_lat = position.coords.latitude;
					my_lng = position.coords.longitude;
					console.log("my location is!");
					console.log(my_lat, my_lng);

					console.log("calling contact server");
					contact_server();
					// update_map();
				});
			} 
			else {
				alert("Your browser doesn't support geolocation!");
			}
		}

		function contact_server() {

			/* XML request variables */
			var request = new XMLHttpRequest();
			var url = "https://secret-about-box.herokuapp.com/sendLocation";
			var params = "login="+"JanetGage"+"&lat="+mylat+"&lng="+mylng+"&message="+"mymessage";
			request.open('POST', 'https://secret-about-box.herokuapp.com/sendLocation', true); 
			
			/* Send proper header information */
			request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			request.setRequestHeader("Content-length", params.length);
			request.setRequestHeader("Connection", "close");

			request.onreadystatechange = function () {
				console.log("inside on ready state change fun");
				if (request.readyState == 4 && request.status == 200) {
					console.log("inside if statement");
					var response = request.responseText;
					console.log("got request???");
					var parsed_objects = JSON.parse(response);
					console.log(parsed_objects);
					console.log("parsed objects!");
					init_map(parsed_objects);
					// What do I do with the response?
				}
			}

			request.send(params);

		}

		// function init_map(parsed_objects) {
		// 	elem = document.getElementById("map");

		// 	for (i = 0; i < parsed_objects.length; i++) {
	 //    		var id = parsed_objects[i]["_id"];
	 //    		var login = parsed_objects[i]["login"];
	 //    		var lat = parsed_objects[i]["lat"];
	 //    		var lng = parsed_objects[i]["lng"];
	 //    		var lng = parsed_objects[i]["message"];
	 //            elem.innerHTML += "<p>" + login + "</p>";
		// 		}
		// }
	


		// /* Updating to my location */
		// function update_map() {
		// 	var me = new google.maps.LatLng(my_lat, my_lng);

		// 	/* Update map and pan to me */
		// 	map.panTo(me);




		// 	var content_string = "<div class = 'string_content'>" + "Jade is here!" + "</div>";

		// 	var marker = new google.maps.Marker ({
		// 		position: me,
		// 		title: "Hello!"
		// 	});

		// 	var infowindow = new google.maps.InfoWindow({
		// 		content: content_string
		// 	});

		// 	marker.addListener('click', function() {
  //   			infowindow.open(map, marker);
  // 			});

		// 	/* Adding marker to map */
		// 	marker.setMap(map);

		// }

	</script>


</head>

<body onload="init()">
	<!-- Making the space for the canvas -->
	<div id="map"></div>
	</body>

</html>